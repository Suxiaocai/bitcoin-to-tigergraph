
//Creates Graph
create vertex Output (primary_id transaction_hash_outid string, outid int, transaction_value int)
create vertex Transaction (primary_id transaction_hash string, txn_size int, version_no int, txn_locktime int, is_coinbase bool)
create vertex Block (primary_id curr_hash string, block_index int, merkle_root string, block_time datetime, block_version int, block_bits int)
create vertex Address (primary_id address string)
create directed edge output_to_address (from Output, to Address) with reverse_edge="address_to_output"
create directed edge txn_output (from Transaction, to Output) with reverse_edge="output_origin_txn"
create directed edge txn_input (from Output, to Transaction) with reverse_edge="txn_origin_input"
create directed edge txn_to_block (from Transaction, to Block) with reverse_edge="block_to_txn"
create directed edge chain (from Block, to Block) with reverse_edge="reverse_chain"
create graph Block_Chain (*)

//Loads csv data into Graph
begin
CREATE LOADING JOB load_blockchain_data FOR GRAPH Block_Chain {
DEFINE FILENAME blocks = "/mnt/hgfs/Desktop/blocks1.csv";
DEFINE FILENAME txns = "/mnt/hgfs/Desktop/transactions1.csv";
DEFINE FILENAME outputs = "/mnt/hgfs/Desktop/output1.csv";

LOAD blocks to vertex Block values ($1,$0,$2,$4,$5,$6);
LOAD txns to vertex Transaction values ($0,$1,$3,$2,$5);
LOAD blocks to edge chain values ($3,$1);
LOAD txns to edge txn_to_block values ($0,$4);
LOAD outputs to vertex Output values ($0,$1,$2);
LOAD outputs to edge output_to_address values ($0,$3);
LOAD outputs to edge txn_output values ($4,$0);

LOAD outputs to vertex Address values ($3);
}
end

LOAD ingoing_payment to edge txn_input values ($0,$2);

DEFINE FILENAME ingoing_payment = "/mnt/hgfs/Desktop/input1.csv";

//Allows for Kafka loading
CREATE data_source Kafka k1 = “/home/tigergraph/tigergraph/kafka.conf”
GRANT data_source k1 to graph Block_Chain
begin
CREATE LOADING JOB load_blockchain_data FOR GRAPH Block_Chain {
DEFINE FILENAME blocks = "$k1:blocks.conf";
DEFINE FILENAME txns = "$k1:transactions.conf";
DEFINE FILENAME outputs = "$k1:outputs.conf";
DEFINE FILENAME ingoing_payment = "$k1:ingoing_payment.conf";
LOAD blocks to vertex Block values ($1,$0,$2,$4,$5,$6);
LOAD txns to vertex Transaction values ($0,$1,$3,$2,$5);
LOAD blocks to edge chain values ($3,$1);
LOAD txns to edge txn_to_block values ($0,$4);
LOAD outputs to vertex Output values ($0,$1,$2);
LOAD outputs to edge output_to_address values ($0,$3);
LOAD outputs to edge txn_output values ($4,$0);
LOAD ingoing_payment to edge txn_input values ($0,$2);
LOAD outputs to vertex Address values ($3);
}
end